// Generated by CoffeeScript 1.10.0
(function() {
  var Achievement, Building, Spell, SummonGolem, achievementCheck, achievements, activeSpells, buildingInsert, buildings, clickValue, cmTime, copyMachine, initStuff, magicMultiplier, mana, modifier, numberShortener, potatoCount, potatoGet, potatoTick, round, sacrifice, spells, tickNum,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  achievements = [];

  Achievement = (function() {
    function Achievement(name, requirements, description, flavour_text) {
      this.name = name;
      this.requirements = requirements;
      this.description = description;
      this.flavour_text = flavour_text;
      this.tryUnlock = bind(this.tryUnlock, this);
      this.unlocked = false;
    }

    Achievement.prototype.tryUnlock = function() {
      if (this.requirements() && !this.unlocked) {
        console.log("achievement unlocked " + this.name);
        return this.unlocked = true;
      }
    };

    return Achievement;

  })();

  achievements[0] = new Achievement("test achievement", function() {
    return potatoCount > 0;
  }, "yeah whatever", "dank reference goes here");

  achievementCheck = function() {
    var i, j, len, results;
    results = [];
    for (j = 0, len = achievements.length; j < len; j++) {
      i = achievements[j];
      if (!i.unlocked) {
        results.push(i.tryUnlock);
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  buildings = [];

  Building = (function() {
    function Building(name, cost1, modifier1, buttonID1, bDesc) {
      this.name = name;
      this.cost = cost1;
      this.modifier = modifier1;
      this.buttonID = buttonID1;
      this.bDesc = bDesc;
      this.built = false;
      this.amount = 0;
    }

    Building.prototype.purchase = function() {
      if (this.getCost() <= potatoCount) {
        this.built = true;
        this.amount += 1;
        potatoCount -= this.getCost();
        return this.increaseCost();
      } else {
        return console.log("Not enough resources?");
      }
    };

    Building.prototype.getMod = function() {
      return this.modifier;
    };

    Building.prototype.isBuilt = function() {
      return this.built;
    };

    Building.prototype.getName = function() {
      return this.name;
    };

    Building.prototype.getCost = function() {
      return this.cost;
    };

    Building.prototype.getNum = function() {
      return this.amount;
    };

    Building.prototype.getButtonId = function() {
      return this.buttonID;
    };

    Building.prototype.getDesc = function() {
      return this.bDesc;
    };

    Building.prototype.increaseCost = function() {
      return this.cost = this.cost * 1.15;
    };

    Building.prototype.setMod = function(number) {
      return this.modifier = number;
    };

    return Building;

  })();

  buildingInsert = function(type, cost, modifier, buttonID, bD) {
    var built, i, j, len, temp;
    built = false;
    if (buildings.length !== 0) {
      for (j = 0, len = buildings.length; j < len; j++) {
        i = buildings[j];
        if (i.getName() === type) {
          i.purchase();
          built = true;
        }
      }
    }
    if (!built) {
      temp = new Building(type, cost, modifier, buttonID, bD);
      console.log(temp.getCost());
      if (!(potatoCount < temp.getCost())) {
        buildings.push(temp);
        return temp.purchase();
      }
    }
  };

  Spell = (function() {
    function Spell(name) {
      this.name = name;
      this.cast = bind(this.cast, this);
      this.tick = bind(this.tick, this);
      this.expiration = bind(this.expiration, this);
      this.effect = bind(this.effect, this);
      this.description;
      this.cost;
      this.duration;
      ({
        duration_cur: 0
      });
    }

    Spell.prototype.effect = function() {
      return this.tick();
    };

    Spell.prototype.expiration = function() {
      return this.duration_cur = 0;
    };

    Spell.prototype.tick = function() {
      if (this.duration_cur > 0) {
        this.duration_cur -= 1;
        return setTimeout(this.tick, 1000);
      } else {
        return this.expiration();
      }
    };

    Spell.prototype.cast = function() {
      if (!(mana < this.cost)) {
        this.duration_cur = this.duration;
        mana -= this.cost;
        return this.effect();
      }
    };

    return Spell;

  })();

  SummonGolem = (function(superClass) {
    extend(SummonGolem, superClass);

    function SummonGolem() {
      this.expiration = bind(this.expiration, this);
      this.effect = bind(this.effect, this);
      SummonGolem.__super__.constructor.call(this, "golem");
    }

    SummonGolem.prototype.description = "summon potato golem to boost your production";

    SummonGolem.prototype.cost = 10;

    SummonGolem.prototype.duration = 60;

    SummonGolem.prototype.effect = function() {
      SummonGolem.__super__.effect.apply(this, arguments);
      return magicMultiplier += 0.15;
    };

    SummonGolem.prototype.expiration = function() {
      return magicMultiplier -= 0.15;
    };

    return SummonGolem;

  })(Spell);

  sacrifice = function(n) {
    if (!(potatoCount < n)) {
      mana += n;
      return potatoCount -= n;
    }
  };

  tickNum = 0;

  potatoCount = 0;

  cmTime = 50;

  modifier = 0;

  magicMultiplier = 1;

  mana = 0;

  spells = {};

  activeSpells = {};

  clickValue = 1;

  initStuff = function() {
    spells["golem"] = new SummonGolem;
    return setInterval(function() {
      potatoTick();
      return achievementCheck();
    }, 1000);
  };

  copyMachine = function() {
    var prob;
    if (potatoUpgrades["copy_machine"] > 0) {
      if (tickNum >= cmTime) {
        prob = Math.floor(Math.random() * 100);
        tickNum = 0;
        if (prob <= 80) {
          return upgradeInsert("farm", "cm");
        } else if (prob <= 95) {
          return upgradeInsert("factory", "cm");
        } else {
          return upgradeInsert("kappa", "cm");
        }
      } else {
        return tickNum += 1;
      }
    }
  };

  potatoGet = function() {
    potatoCount += clickValue;
    return $("#label").text("Potatoes: " + (numberShortener(potatoCount)));
  };

  potatoTick = function() {
    var building, j, len;
    modifier = 0;
    for (j = 0, len = buildings.length; j < len; j++) {
      building = buildings[j];
      modifier += building.getMod() * building.getNum();
    }
    return potatoCount += modifier * magicMultiplier;
  };

  round = function(number, n) {
    if (n == null) {
      n = 3;
    }
    if (n === 1) {
      return Math.round(number);
    }
    return Math.round(number * (Math.pow(10, n))) / (Math.pow(10, n));
  };

  numberShortener = function(number) {
    var arr, multiplier;
    if (number < 1000) {
      return round(number);
    }
    arr = ['K', 'M', 'B', 'T', 'Qa', 'Qi'];
    multiplier = 1;
    while (!((Math.pow(10, 3 * (multiplier + 1))) > number)) {
      multiplier += 1;
    }
    return "" + (round(number / (Math.pow(10, multiplier * 3)))) + arr[multiplier - 1];
  };

  $(function() {
    var displayBuildings, initUi, listeners, uiUpdate;
    initUi = function() {
      $("#buttons").append("<input id='bFarm' type='button' value='Build a farm: 10'/>");
      $("#buttons").append("<input id='bFactory' type='button' value='Build a factory: 100'/>");
      $("#buttons").append("<input id='bKappa' type='button' value='Build a kappa: 500'/>");
      return setInterval(uiUpdate, 200);
    };
    displayBuildings = function() {
      var building, j, len, results;
      $("#resourceDisplay").text("");
      results = [];
      for (j = 0, len = buildings.length; j < len; j++) {
        building = buildings[j];
        results.push($("#resourceDisplay").append("<p>" + (building.getName()) + ": " + (building.getNum()) + "</p>"));
      }
      return results;
    };
    listeners = function() {
      $("#bFactory").on("click", function() {
        return buildingInsert("factory", 100, 10, "bFactory", "Build a factory");
      });
      $("#bKappa").on("click", function() {
        return buildingInsert("kappa", 500, 30, "bKappa", "Build a farm");
      });
      return $("#bFarm").on("click", function() {
        return buildingInsert("farm", 10, 2, "bFarm", "Build a kappa");
      });
    };
    $("#potatoGet").on("click", function() {
      return potatoGet();
    });
    $(":button").on("click", function() {
      return uiUpdate();
    });
    $("#sacrifice1").on("click", function() {
      return sacrifice(1);
    });
    $("#spell1").on("click", function() {
      return spells["golem"].cast();
    });
    uiUpdate = function() {
      var building, j, len;
      for (j = 0, len = buildings.length; j < len; j++) {
        building = buildings[j];
        $("#" + (building.getButtonId())).attr("value", (building.getDesc()) + " : " + (numberShortener(building.getCost())));
      }
      $("#label").text("Potatoes: " + (numberShortener(potatoCount)));
      $("#ps").text("Potatoes/second: " + (numberShortener(modifier)));
      $("#mana").text("mana: " + mana);
      $("#spellmod").text("" + (numberShortener(magicMultiplier)));
      return displayBuildings();
    };
    initStuff();
    initUi();
    return listeners();
  });

}).call(this);
