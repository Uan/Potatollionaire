// Generated by CoffeeScript 1.10.0
(function() {
  var Achievement, Building, Spell, SummonGolem, achievementCheck, achievements, activeSpells, buildings, cmTime, copyMachine, countConvert, initStuff, magicMultiplier, mana, modifier, potatoCount, potatoGet, potatoTick, roundToTwo, sacrifice, spells, tickNum, upgradeInsert,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  achievements = [];

  Achievement = (function() {
    function Achievement(name, requirements, description, flavour_text) {
      this.name = name;
      this.requirements = requirements;
      this.description = description;
      this.flavour_text = flavour_text;
      this.tryUnlock = bind(this.tryUnlock, this);
      this.unlocked = false;
    }

    Achievement.prototype.tryUnlock = function() {
      if (this.requirements() && !this.unlocked) {
        console.log("achievement unlocked " + this.name);
        return this.unlocked = true;
      }
    };

    return Achievement;

  })();

  achievements[0] = new Achievement("test achievement", function() {
    return potatoCount > 0;
  }, "yeah whatever", "dank reference goes here");

  achievementCheck = function() {
    var i, j, len, results;
    results = [];
    for (j = 0, len = achievements.length; j < len; j++) {
      i = achievements[j];
      if (!i.unlocked) {
        results.push(i.tryUnlock);
      } else {
        results.push(void 0);
      }
    }
    return results;
  };

  buildings = [];

  Building = (function() {
    function Building(name, cost1, modifier1) {
      this.name = name;
      this.cost = cost1;
      this.modifier = modifier1;
      this.built = false;
      this.cost;
      this.description;
      this.modifier;
      this.amount = 0;
    }

    Building.prototype.calculatePrice = function() {
      if (this.amount > 0) {
        console.log("HAAAAAAAAAA");
        this.cost = this.cost * 1.15;
      }
      return this.cost;
    };

    Building.prototype.purchase = function() {
      this.built = true;
      if (potatoCount >= this.calculatePrice()) {
        this.amount += 1;
        return potatoCount -= this.cost;
      } else {
        return console.log("KAPPA");
      }
    };

    Building.prototype.getMod = function() {
      return this.modifier;
    };

    Building.prototype.isBuilt = function() {
      return this.built;
    };

    Building.prototype.getName = function() {
      return this.name;
    };

    Building.prototype.getNum = function() {
      return this.amount;
    };

    return Building;

  })();

  upgradeInsert = function(type, cost, modifier) {
    var built, i, j, len, temp;
    console.log("HEEEEEY");
    built = false;
    if (buildings.length !== 0) {
      for (j = 0, len = buildings.length; j < len; j++) {
        i = buildings[j];
        if (i.getName === type) {
          i.purchase;
          built = true;
        }
      }
    }
    if (!built) {
      console.log("AYYYYYY");
      temp = new Building(type, cost, modifier);
      return temp.purchase();
    }
  };

  Spell = (function() {
    function Spell(name) {
      this.name = name;
      this.cast = bind(this.cast, this);
      this.tick = bind(this.tick, this);
      this.expiration = bind(this.expiration, this);
      this.effect = bind(this.effect, this);
      this.description;
      this.cost;
      this.duration;
      ({
        duration_cur: 0
      });
    }

    Spell.prototype.effect = function() {
      return this.tick();
    };

    Spell.prototype.expiration = function() {
      return this.duration_cur = 0;
    };

    Spell.prototype.tick = function() {
      if (this.duration_cur > 0) {
        this.duration_cur -= 1;
        return setTimeout(this.tick, 1000);
      } else {
        return this.expiration();
      }
    };

    Spell.prototype.cast = function() {
      if (!(mana < this.cost)) {
        this.duration_cur = this.duration;
        mana -= this.cost;
        return this.effect();
      }
    };

    return Spell;

  })();

  SummonGolem = (function(superClass) {
    extend(SummonGolem, superClass);

    function SummonGolem() {
      this.expiration = bind(this.expiration, this);
      this.effect = bind(this.effect, this);
      SummonGolem.__super__.constructor.call(this, "golem");
    }

    SummonGolem.prototype.description = "summon potato golem to boost your production";

    SummonGolem.prototype.cost = 10;

    SummonGolem.prototype.duration = 60;

    SummonGolem.prototype.effect = function() {
      SummonGolem.__super__.effect.apply(this, arguments);
      return magicMultiplier += 0.15;
    };

    SummonGolem.prototype.expiration = function() {
      return magicMultiplier -= 0.15;
    };

    return SummonGolem;

  })(Spell);

  sacrifice = function(n) {
    if (!(potatoCount < n)) {
      mana += n;
      return potatoCount -= n;
    }
  };

  tickNum = 0;

  potatoCount = 0;

  cmTime = 50;

  modifier = 0;

  magicMultiplier = 1;

  mana = 0;

  spells = {};

  activeSpells = {};

  initStuff = function() {
    spells["golem"] = new SummonGolem;
    return setInterval(function() {
      potatoTick();
      return achievementCheck();
    }, 1000);
  };

  copyMachine = function() {
    var prob;
    if (potatoUpgrades["copy_machine"] > 0) {
      if (tickNum >= cmTime) {
        prob = Math.floor(Math.random() * 100);
        tickNum = 0;
        if (prob <= 80) {
          return upgradeInsert("farm", "cm");
        } else if (prob <= 95) {
          return upgradeInsert("factory", "cm");
        } else {
          return upgradeInsert("kappa", "cm");
        }
      } else {
        return tickNum += 1;
      }
    }
  };

  potatoGet = function() {
    potatoCount += 1;
    return $("#label").text("Potatoes: " + (countConvert(potatoCount)));
  };

  potatoTick = function() {
    var j, len, type;
    for (j = 0, len = buildings.length; j < len; j++) {
      type = buildings[j];
      modifier += type.getMod() * type.getNum();
    }
    potatoCount += modifier * magicMultiplier;
    return modifier = 0;
  };

  roundToTwo = function(number) {
    return Math.round(number * 10) / 10;
  };

  countConvert = function(number) {
    if (number >= 1000000000) {
      return roundToTwo(number / 1000000000) + "B";
    } else if (number >= 1000000) {
      return roundToTwo(number / 1000000) + "M";
    } else if (number >= 1000) {
      return roundToTwo(number / 1000) + "K";
    } else {
      return roundToTwo(number);
    }
  };

  $(function() {
    var buttonValues, displayBuildings, initUi, uiUpdate;
    initUi = function() {
      return setInterval(uiUpdate, 200);
    };
    displayBuildings = function() {
      var i, j, len, results;
      $("#resourceDisplay").text("");
      results = [];
      for (j = 0, len = buildings.length; j < len; j++) {
        i = buildings[j];
        results.push($("#resourceDisplay").append("<p>" + i.getName + ": " + i.getNum + "</p>"));
      }
      return results;
    };
    buttonValues = function() {
      $("#upgradeBtnF").attr("value", "Build a Farm. Cost: " + (countConvert(upgradeCosts["farm"])));
      $("#upgradeBtnFa").attr("value", "Build a Factory. Cost: " + (countConvert(upgradeCosts["factory"])));
      $("#upgradeBtnK").attr("value", "Build a Kappa. Cost: " + (countConvert(upgradeCosts["kappa"])));
      return $("#upgradeBtnC").attr("value", "Build a Copy machine. Cost: " + (countConvert(upgradeCosts["copy_machine"])));
    };
    $("#upgradeBtnFa").on("click", function() {
      return upgradeInsert("factory", 10, 2);
    });
    $("#upgradeBtnK").on("click", function() {
      return upgradeInsert("kappa", "user");
    });
    $("#upgradeBtnF").on("click", function() {
      return upgradeInsert("farm", "user");
    });
    $("#upgradeBtnC").on("click", function() {
      return upgradeInsert("copy_machine", "user");
    });
    $("#potatoGet").on("click", function() {
      return potatoGet();
    });
    $(":button").on("click", function() {
      return uiUpdate();
    });
    $("#sacrifice1").on("click", function() {
      return sacrifice(1);
    });
    $("#spell1").on("click", function() {
      return spells["golem"].cast();
    });
    uiUpdate = function() {
      $("#label").text("Potatoes: " + (countConvert(potatoCount)));
      $("#ps").text("Potatoes/second: " + (countConvert(modifier)));
      $("#mana").text("mana: " + mana);
      $("#spellmod").text("" + (countConvert(magicMultiplier)));
      displayBuildings();
      return buttonValues();
    };
    initStuff();
    return initUi();
  });

}).call(this);
